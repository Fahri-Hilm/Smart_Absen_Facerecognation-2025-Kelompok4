<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Training Loader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>ğŸ§ª Test Training Loader</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Manual Test</h5>
                    </div>
                    <div class="card-body">
                        <button id="testLoader" class="btn btn-primary">ğŸš€ Test Loading</button>
                        <button id="hideLoader" class="btn btn-secondary">âŒ Hide Loading</button>
                        
                        <hr>
                        
                        <button id="simulateTraining" class="btn btn-success">ğŸ¤– Simulate Training</button>
                        <button id="testRealTraining" class="btn btn-warning">âš¡ Test Real Training</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Training Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="statusDisplay">
                            <p>Status akan muncul di sini...</p>
                        </div>
                        
                        <button id="checkStatus" class="btn btn-info btn-sm">ğŸ” Check Status</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/training-loader.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Test manual loader
            document.getElementById('testLoader').addEventListener('click', () => {
                showTrainingLoader('Test Employee', 'Testing loading indicator...', 45);
            });

            document.getElementById('hideLoader').addEventListener('click', () => {
                hideTrainingLoader();
            });

            // Simulate training process
            document.getElementById('simulateTraining').addEventListener('click', () => {
                simulateTrainingProcess();
            });

            // Test real training
            document.getElementById('testRealTraining').addEventListener('click', async () => {
                try {
                    const response = await fetch('/test/auto-training');
                    const result = await response.text();
                    document.getElementById('statusDisplay').innerHTML = result;
                } catch (error) {
                    console.error('Error:', error);
                }
            });

            // Check status
            document.getElementById('checkStatus').addEventListener('click', async () => {
                try {
                    const response = await fetch('/api/training_status');
                    const status = await response.json();
                    document.getElementById('statusDisplay').innerHTML = `
                        <pre>${JSON.stringify(status, null, 2)}</pre>
                    `;
                } catch (error) {
                    console.error('Error:', error);
                }
            });
        });

        function simulateTrainingProcess() {
            const steps = [
                { progress: 10, message: 'Memulai training...' },
                { progress: 30, message: 'Memuat model InsightFace...' },
                { progress: 50, message: 'Memproses foto wajah...' },
                { progress: 70, message: 'Membuat embeddings...' },
                { progress: 90, message: 'Menyimpan model...' },
                { progress: 100, message: 'Training selesai!' }
            ];

            let currentStep = 0;
            
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    showTrainingLoader('Simulasi Employee', step.message, step.progress);
                    currentStep++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        hideTrainingLoader();
                    }, 2000);
                }
            }, 1000);
        }
    </script>
</body>
</html>
